<?xml version="1.0" encoding="utf-8"?>
<link:linkbase 
  xmlns:link="http://www.xbrl.org/2003/linkbase" 
  xmlns:generic="http://xbrl.org/2008/generic" 
  xmlns:formula="http://xbrl.org/2008/formula" 
  xmlns:variable="http://xbrl.org/2008/variable" 
  xmlns:cf="http://xbrl.org/2008/filter/concept" 
  xmlns:df="http://xbrl.org/2008/filter/dimension" 
  xmlns:ef="http://xbrl.org/2008/filter/entity" 
  xmlns:gf="http://xbrl.org/2008/filter/general" 
  xmlns:pf="http://xbrl.org/2008/filter/period" 
  xmlns:tf="http://xbrl.org/2008/filter/tuple" 
  xmlns:uf="http://xbrl.org/2008/filter/unit" 
  xmlns:vf="http://xbrl.org/2008/filter/value" 
  xmlns:label="http://xbrl.org/2008/label" 
  xmlns:eg="http://xbrl.org/formula/conformance/example" 
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
  xmlns:xs="http://www.w3.org/2001/XMLSchema"
  xmlns:xfi="http://www.xbrl.org/2008/function/instance" 
  xmlns:xlink="http://www.w3.org/1999/xlink" 
  xmlns:xbrli="http://www.xbrl.org/2003/instance" 
  xsi:schemaLocation="
  http://www.xbrl.org/2003/linkbase
    http://www.xbrl.org/2003/xbrl-linkbase-2003-12-31.xsd
  http://xbrl.org/2008/generic
    ../../../core_schemas/generic-link.xsd 
  http://xbrl.org/2008/formula
    ../../../core_schemas/formula.xsd
  http://xbrl.org/2008/variable
    ../../../core_schemas/variable.xsd
  http://xbrl.org/2008/filter/concept
    ../../../core_schemas/concept-filter.xsd
  http://xbrl.org/2008/filter/tuple
    ../../../core_schemas/tuple-filter.xsd
  http://xbrl.org/2008/label
    ../../../core_schemas/generic-label.xsd
  http://xbrl.org/formula/conformance/example
    22170-sequence-dim-tests.xsd"
  >
  <link:arcroleRef arcroleURI="http://xbrl.org/arcrole/2008/variable-set" xlink:href="../../../core_schemas/variable.xsd#variable-set" xlink:type="simple"/>
  <link:arcroleRef arcroleURI="http://xbrl.org/arcrole/2008/variable-filter" xlink:href="../../../core_schemas/variable.xsd#variable-filter" xlink:type="simple"/>
   <link:arcroleRef arcroleURI="http://xbrl.org/arcrole/2008/variable-set-precondition"
                    xlink:href="../../../core_schemas/variable.xsd#variable-set-precondition"
                    xlink:type="simple"/>  <link:roleRef roleURI="http://www.xbrl.org/2008/role/link" xlink:href="../../../core_schemas/generic-link.xsd#standard-link-role" xlink:type="simple"/>

  <generic:link xlink:type="extended" xlink:role="http://www.xbrl.org/2008/role/link">
    <formula:formula xlink:type="resource" xlink:label="dupCheck" 
      value="
         if (every $item in subsequence($v,2) satisfies ($item eq $v[1]))
           then concat(local-name($v[1]), ' yes')
           else concat(local-name($v[1]), ' no')
           "
      aspectModel="dimensional" implicitFiltering="false" >
      <!-- no source because implicitFiltering is false, 
           so all aspects explicitly specified -->
      <formula:aspects>
        <formula:concept>
          <formula:qname>eg:Moon</formula:qname>
        </formula:concept>
        <formula:entityIdentifier
          scheme="'http://xbrl.org/entity/identification/scheme'"
          value="'01'"/>
        <formula:period>
          <formula:instant value="xs:date('2007-12-31')"/>
        </formula:period>
        <formula:explicitDimension
          dimension="eg:MoonDim">
          <formula:member>
            <formula:qnameExpression>
              xfi:fact-explicit-dimension-value($v[1],
                    QName('http://xbrl.org/formula/conformance/example',
                          'eg:MoonDim'))
            </formula:qnameExpression>
          </formula:member>
        </formula:explicitDimension>
      </formula:aspects>
     </formula:formula>


    <!-- $dups picks up ALL items from instance (regardless of dimension),
         but sequence is broken down by dimension and concept name, and
         within each, is checked to precondition for more than one, and if so
         check for dups in assertion -->
    <variable:factVariable xlink:type="resource" xlink:label="factvar1" bindAsSequence="true" matches="true" />

    <!-- v -->
    <variable:variableArc xlink:type="arc" xlink:to="factvar1" xlink:from="dupCheck" xlink:arcrole="http://xbrl.org/arcrole/2008/variable-set"
      name="v" />

    <!-- check that sequence has more than one member -->
    <generic:arc xlink:from="dupCheck" xlink:to="precond"
                   xlink:arcrole="http://xbrl.org/arcrole/2008/variable-set-precondition"
                   xlink:type="arc"
                   order="1"/>
    <variable:precondition test="count($v) gt 1" xlink:label="precond" xlink:type="resource"/>

  </generic:link>
</link:linkbase>



